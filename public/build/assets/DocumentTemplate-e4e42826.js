import{V as d,a as p}from"./DocumentEditor-77a62aa1.js";import c from"./InvoiceTemplate-39833a15.js";import{_ as f}from"./_plugin-vue_export-helper-c27b6911.js";import{a1 as g,a2 as a,o as m,d as v,b as l,c as y,g as x}from"./app-e263ac0f.js";import"./print-b31df52a.js";const w={props:{ordonnanceData:Object},components:{VueDocumentEditor:d,VueFileToolbarMenu:p,InvoiceTemplate:c},data(){return{content:[{template:g(c),props:{dataord:this.$props.ordonnanceData}}],zoom:.72,zoom_min:.1,zoom_max:5,page_format_mm:[210,297],page_margins:"10mm 15mm",display:"vertical",mounted:!1,undo_count:-1,content_history:[],showInvoiceTemplate:!1,invoiceData:null}},created(){let e=!1,i=!1,n=!1;window.addEventListener("wheel",t=>{t.ctrlKey&&(t.preventDefault(),this.zoom=Math.min(Math.max(this.zoom-t.deltaY*.01,this.zoom_min),this.zoom_max))},{passive:!1}),window.addEventListener("gesturestart",t=>{t.preventDefault(),e=this.zoom}),window.addEventListener("gesturechange",t=>{t.preventDefault(),n||(this.zoom=Math.min(Math.max(e*t.scale,this.zoom_min),this.zoom_max))}),window.addEventListener("gestureend",()=>{e=!1}),window.addEventListener("touchstart",t=>{t.touches.length==2&&(t.preventDefault(),i=Math.hypot(t.touches[0].pageX-t.touches[1].pageX,t.touches[0].pageY-t.touches[1].pageY),n=this.zoom)},{passive:!1}),window.addEventListener("touchmove",t=>{if(i&&n){t.preventDefault();let r=n*Math.hypot(t.touches[0].pageX-t.touches[1].pageX,t.touches[0].pageY-t.touches[1].pageY)/i;this.zoom=Math.min(Math.max(r,this.zoom_min),this.zoom_max)}},{passive:!1}),window.addEventListener("touchend",()=>{i=!1,n=!1},{passive:!1});const o=t=>{switch(t&&t.inputType){case"historyUndo":t.preventDefault(),t.stopPropagation(),this.undo();break;case"historyRedo":t.preventDefault(),t.stopPropagation(),this.redo();break}};window.addEventListener("beforeinput",o),window.addEventListener("input",o)},mounted(){this.mounted=!0},computed:{menu(){return[{text:"Imprimer",title:"Print",icon:"print",click:this.printInvoice},{title:"Undo",icon:"undo",disabled:!this.can_undo,hotkey:this.isMacLike?"command+z":"ctrl+z",click:()=>this.undo()},{title:"Redo",icon:"redo",disabled:!this.can_redo,hotkey:this.isMacLike?"shift+command+z":"ctrl+y",click:()=>this.redo()},{is:"separator"},{text:this.current_format_name,title:"Format",icon:"crop_free",chevron:!0,menu:this.formats.map(([e,i,n])=>({text:e,active:this.page_format_mm[0]==i&&this.page_format_mm[1]==n,click:()=>{this.page_format_mm=[i,n]}})),menu_width:80,menu_height:280},{text:this.current_margins_name,title:"Margins",icon:"select_all",chevron:!0,menu:this.margins.map(([e,i])=>({text:e+" ("+i+")",active:this.page_margins==i,click:()=>{this.page_margins=i}})),menu_width:200,menu_class:"align-center"},{title:"Display",icon:this.display=="horizontal"?"view_column":this.display=="vertical"?"view_stream":"view_module",chevron:!0,menu:[{icon:"view_module",active:this.display=="grid",click:()=>{this.display="grid"}},{icon:"view_column",active:this.display=="horizontal",click:()=>{this.display="horizontal"}},{icon:"view_stream",active:this.display=="vertical",click:()=>{this.display="vertical"}}],menu_width:55,menu_class:"align-right"}]},current_format_name(){const e=this.formats.find(([,i,n])=>this.page_format_mm[0]==i&&this.page_format_mm[1]==n);return e?e[0]:this.page_format_mm[0]+"mm x "+this.page_format_mm[1]+"mm"},formats:()=>[["A4",210,297]],current_margins_name(){const e=this.margins.find(([,i])=>this.page_margins==i);return e?e[0]:this.page_margins},margins:()=>[["Medium","20mm"],["Small","15mm"],["Slim","10mm 15mm"],["Tiny","5mm"]],current_text_style(){return this.mounted?this.$refs.editor.current_text_style:!1},isLeftAligned(){return["start","left","-moz-left"].includes(this.current_text_style.textAlign)},isRightAligned(){return["end","right","-moz-right"].includes(this.current_text_style.textAlign)},isCentered(){return["center","-moz-center"].includes(this.current_text_style.textAlign)},isJustified(){return["justify","justify-all"].includes(this.current_text_style.textAlign)},isBold(){const e=this.current_text_style.fontWeight;return e&&(parseInt(e)>400||e.indexOf("bold")==0)},isItalic(){return this.current_text_style.fontStyle=="italic"},isUnderline(){const e=this.current_text_style.textDecorationStack;return e&&e.some(i=>i.indexOf("underline")==0)},isStrikeThrough(){const e=this.current_text_style.textDecorationStack;return e&&e.some(i=>i.indexOf("line-through")==0)},isNumberedList(){return this.current_text_style.isList&&this.current_text_style.listStyleType=="decimal"},isBulletedList(){return this.current_text_style.isList&&["disc","circle"].includes(this.current_text_style.listStyleType)},isH1(){return this.current_text_style.headerLevel==1},isH2(){return this.current_text_style.headerLevel==2},isH3(){return this.current_text_style.headerLevel==3},curColor(){return this.current_text_style.color||"transparent"},isMacLike:()=>/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),can_undo(){return this.undo_count>0},can_redo(){return this.content_history.length-this.undo_count-1>0}},methods:{overlay(e,i){let n='<div style="position: absolute; bottom: 8mm; '+(e%2?"right":"left")+': 10mm">Page '+e+" of "+i+"</div>";return e>=3&&(n+='<div style="position: absolute; left: 0; top: 0; right: 0; padding: 3mm 5mm; background: rgba(200, 220, 240, 0.5)"><strong>MYCOMPANY</strong> example.com /// This is a custom header overlay</div>',n+='<div style="position: absolute; left: 10mm; right: 10mm; bottom: 5mm; text-align:center; font-size:10pt">MY COMPANY - example.com /// This is a custom footer overlay</div>'),n},pri(){window.print()},undo(){this.can_undo&&(this._mute_next_content_watcher=!0,this.content=this.content_history[--this.undo_count])},redo(){this.can_redo&&(this._mute_next_content_watcher=!0,this.content=this.content_history[++this.undo_count])},resetContentHistory(){this.content_history=[],this.undo_count=-1},async insertPageBreak(){document.execCommand("insertParagraph");const e="###PB###";document.execCommand("insertText",!1,e),await this.$nextTick(),await this.$nextTick();const i=new RegExp("<(p|div|h\\d)( [^/>]+)*>(<[^/>]+>)*"+e);for(let n=0;n<this.content.length;n++){const o=this.content[n];if(typeof o!="string")continue;const t=i.exec(o);if(t){const r=t[0].slice(0,-e.length);let s=o.substr(t.index+t[0].length);s.indexOf("</")==0&&(s="<br>"+s),this.content.splice(n,1,o.substr(0,t.index),r+s);return}}for(let n=0;n<this.content.length;n++){const o=this.content[n];if(!(typeof o!="string"||o.indexOf(e)<0)){this.content.splice(n,1,o.replace(e,""));break}}},printInvoice(){this.invoiceData={dataord:this.$props.ordonnanceData},this.showInvoiceTemplate=!0,this.$nextTick(()=>{this.$refs.invoiceTemplate.printInvoice(),this.showInvoiceTemplate=!1})}},watch:{content:{immediate:!0,handler(e){this._mute_next_content_watcher||(this.content_history[++this.undo_count]=e,this.content_history.length=this.undo_count+1),this._mute_next_content_watcher=!1}}}},k={class:"main"};function z(e,i,n,o,t,r){const s=a("vue-file-toolbar-menu"),h=a("vue-document-editor"),u=a("invoice-template");return m(),v("div",k,[l(s,{content:r.menu,class:"bar"},null,8,["content"]),l(h,{class:"editor",ref:"editor",content:t.content,"onUpdate:content":i[0]||(i[0]=_=>t.content=_),zoom:t.zoom,page_format_mm:t.page_format_mm,page_margins:t.page_margins,display:t.display},null,8,["content","zoom","page_format_mm","page_margins","display"]),t.showInvoiceTemplate?(m(),y(u,{key:0,modelValue:t.invoiceData,ref:"invoiceTemplate"},null,8,["modelValue"])):x("",!0)])}const E=f(w,[["render",z],["__scopeId","data-v-a8b92efe"]]);export{E as default};
